# Описание работы проекта PngPreProcessor

Проект предназначен для загрузки файлов на "сервер" (каталог wwwroots/files) и дальнейшем запуске процесса обработки.
Имеется небольшая визуальная часть, позволяющая загружать файлы, отслеживать статус и процесс обработки и при необходимости отменять его. 
После запуска проекта визуал находится по ссылке: https://localhost:44347/Home/Index.

## Алгоритм

Запуск загрузки файла на сервер (эндпоинт /uploadFile) запускает весь необходимый процесс загрузки и обработки файла. Процесс включает в себя следующие шаги:
1.  Проверка на наличие загружаемого файла. 
2.  Формирование объекта FileModel. Здесь формируется первоначальный объект, с которым далее будут вестись все процессы. Помимо заполнения значений базовых полей (ид, имя, путь, файл) в конструкторе идёт установка статуса Created, создание потока и токена отмены.
3.  Файл добавляется в общий контекст приложения. Контекст в данном случае представляет собой класс со списком файлов, добавленных в процессе работы веб-приложения, и метода Add для добавления файла в список. В дальнейшем (при необходимости) данный контекст может быть заменён на класс, работающий с БД или любым другим источником данных.
4.  В контексте ищется недавно добавленный файл и запускается поток, прикреплённый к конкретномцу файлу и его методам. С этого момента операции по загрузке файла и его обработке работают в отдельном потоке.
5.  Загрузка файла на "сервер". В качестве файлового сервера используется директория wwwroots/files.
6.  Обработка файла с помощью ImageProcessor'а.

В процессе обработки файла, операцию можно отменить, вызвав эндпоинт https://localhost:44347/files/cancelProcess?id=/*ид объекта*/

Также, в любой момент работы приложения можно просмотреть статус работы. 
Возможные статусы:
*   0 - Created - Создан объект
*   1 - Upload - Загружается на сервер
*   2 - InQueueToProcess - В очереди на обработку
*   3 - InProcess - Выполняется обработка
*   4 - Finished - Завершено
*   5 - Canceled - Отменено
*   6 - Error - Ошибка

## Состав

Проект содержит 2 контроллера: 
*   HomeController - контрололер для работы с визуальной частью;
*   FilesController - контроллер для работы с API.

Функционально контроллеры одинаковые. Они выполняют похожие функции, и обращаются к одним и тем же сервисам. 
Но HomeController используется для работы с визуальным представлением процесса загрузки и обработки файлов и после каждого вызова делает переход обратно на главную страницу.
<RedirectToAction("Index", "Home"). >

Для работы с API без использования визуала можно обращаться к контроллеру FilesController.

## Endpoints

В каждом из контроллеров есть следующие эндпоинты:
*   getFiles() - Получить список файлов с информацией (ид, имя, путь, полный путь, статус, процент выполнения обработки, текст ошибки если имеется)
*   getFilesInProcess() - Получить список файлов с информацией, находящихся в процессе обработки.
*   uploadFile([FromForm(Name = "uploadedFile")] IFormFile uploadedFile) - Загрузить файл. Для передачи файла в параметр нужно заполнить следущие параметры:
*   *   Content-Type = multipart/form-data
*   *   Body = form-data
*   *   File: key = uploadedFile; value = файл
*   cancelProcess(string id) - Отменить обработку файла с указанным ИД (передаётся в параметре)